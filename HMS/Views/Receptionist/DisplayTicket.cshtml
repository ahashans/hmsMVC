@model HMS.ViewModel.TicketUserViewModel
@{
    ViewBag.Title = "DisplayTicket";
}

<h2>Display All Tickets</h2>
<div class="form-horizontal">
    <div class="form-group">
        <label class="control-label">Patient Name</label>
        <div class="">
            @Html.DropDownList("ddlPatient", new SelectList(Model.Patients, "Id", "FullName"), "Select a Patient", htmlAttributes: new { @class = "form-control", onchange = "javascript:getTickets(this.value);" })
                        
        </div>
        <br />
        <div id="ticketInfo">
            <table id="ticketTable" class="table table-bordered table-hover table-responsive table-striped table-condensed dataTable">
                <thead>
                <tr>
                    <th>Patient Name</th>
                    <th>Department</th>
                    <th>Bill Amount</th>
                    <th>Payment Method</th>
                    <th>Card Number</th>
                    <th>Payment Date</th>
                    <th>Ticket Status</th>
                    <th>Ticket Created By</th>
                </tr>
                </thead>
                <tbody>
                
                </tbody>
            </table>
        </div>
    </div>
</div>
@section scripts
{
    @Scripts.Render("~/bundles/jqueryval")
    <script type="text/javascript">
        $("#ticketInfo").slideUp("fast");
        function getTickets(patientId) {
            if (patientId) {
                $("#ticketInfo").slideDown("slow");
//                var url = "/Receptionist/GetTickets/";
//                $.ajax({
//                    url: url,
//                    data: { patientid: patientId },
//                    cache: false,
//                    type: "GET",
//                    success: function (data) {
//                        console.log(data);
//                        for (var i = 0; i < data.length; i++) {
//                            var date = moment(data[0].PaymentTimeStamp).format("DD-MMM-YYYY");
//                            console.log(date);
//                        }
//                    },
//                    error: function (reponse) {
//                        alert("error : " + reponse);
//                    }
//                });
                $("#ticketTable").DataTable({
                    serverSide:false,
                    processing:true,
                    destroy:true,
                    ajax: {
                        type: "POST",
                        url: "/Receptionist/GetTickets",
                        data: { patientid: patientId },
                        dataSrc:""
                    },
                    columns: [
                        {
                            data: "PatientUser",
                            render: function (data, type, ticket) {
                                return data.FullName;
                            }
                        }, {
                            data: "Department",
                            render: function (data, type, ticket) {
                                return data.Name;
                            }
                        }, {
                            data: "BillAmount"

                        }, {
                            data:"PaymentMethod"
                        }, {
                            data: "CardNumber"
                        }, {
                            data: "PaymentTimeStamp",
                            render: function(data,type, ticket) {
                                return moment(data).format("DD-MMM-YYYY");
                            }
                        }, {
                            data: "TicketStatus"
                        }, {
                            data: "ReceptionistUser",
                            render: function (data, type, ticket) {
                                return data.FullName;
                            }
                        }



                    ]
                });
            } else {
                $("#ticketInfo").slideUp("fast");
            }
        }
    </script>
}
